trigger VehicleTrigger on Vehicle__c (before insert, before update) {
    // Set to store all vehicle registration numbers (Names)
    Set<String> vehicleNames = new Set<String>();

    // Loop through the records in the trigger
    for (Vehicle__c vehicle : Trigger.new) {
        // Check if the name is not blank
        if (!String.isBlank(vehicle.Name)) {
            vehicleNames.add(vehicle.Name.trim().toUpperCase());
        }
    }

    // Query for existing records with the same registration numbers
    if (!vehicleNames.isEmpty()) {
        List<Vehicle__c> existingVehicles = [
            SELECT Id, Name 
            FROM Vehicle__c 
            WHERE Name IN :vehicleNames
        ];

        // Create a set of existing vehicle names to compare
        Set<String> existingVehicleNames = new Set<String>();
        for (Vehicle__c existing : existingVehicles) {
            existingVehicleNames.add(existing.Name.trim().toUpperCase());
        }

        // Loop through the new records again to add errors if duplicates are found
        for (Vehicle__c vehicle : Trigger.new) {
            if (existingVehicleNames.contains(vehicle.Name.trim().toUpperCase())) {
                // Add the error directly to the 'Name' field, representing the Vehicle Registration Number
                vehicle.Name.addError('A vehicle with this registration number already exists.');
            }
        }
    }
}
